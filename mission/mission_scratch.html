<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../js/vendor/bs4/css/bootstrap.min.css">
    <link rel="stylesheet" href="../js/vendor/jquery-editable-select-master/dist/jquery-editable-select.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!-- vendor css -->
    <link rel="stylesheet" href="../js/vendor/swiper/css/swiper.min.css">

    <!-- custom css -->
    <link rel="stylesheet" href="../styles/css.min.css">
    
    <link rel="stylesheet" href="../styles/style.min.css">
    <link rel="stylesheet" href="../styles/mission.min.css">
    <link rel="stylesheet" href="../styles/animate.min.css">

    <title>Mobii! - 我的首頁</title>
</head>

<body>    
<div class="wrap container">
    <header>
        <div class="header-secondary container linebt-row">
            <div class="index-flex justify-content-between">
                <div class="item two">
                    <div class="close-btn">
                         <button type="button" class="btn" onclick="history.back();" data-toggle="tooltip" data-placement="bottom" title="回上一頁">
                            <i class="material-icons">&#xe314;</i>
                        </button>
                    </div>
                </div>
                <div class="item three text-center">
                    <div class="title-name">刮刮樂遊戲</div>
                </div>
                <div class="item two">
                    <button type="button" class="btn bluedk-outline-btn bt-small" onclick="callsortLayer('.scratch-rules')">活動規則</button>
                </div>
            </div>
        </div>
    </header>
    <div class="missionlist">

        <div><img src="../img/mission/banner2.png" class="img-fluid"></div>
        <div class="bg-mission p-3">
            <div class="bg-white flex-inline-between px-2 brder-mission">
                <div class="d-flex align-items-center">
                    <img src="../img/share/mobiicoin_red.png" class="h24">
                    <span class="mobiicoin-num">2,366</span>
                </div>
                <div class="d-flex align-items-center">
                    可玩次數&ensp;<span class="mobiicoin-num">3</span>&ensp;次
                </div>
            </div>
        </div>    
        <div class="scratch-box bg-m1">
            <div class="conopybox-top">
                <section class="conopybox">
                    <div class="item canopy-l"></div>
                    <div class="item canopy-c"></div>
                    <div class="item canopy-r"></div>
                </section>
            </div>
        </div>
    
        <div class="scratch-cont">
            <h5>SCRATCH HERE</h5> 
            <canvas id="bottom"></canvas>
            <canvas id="top"></canvas>
        </div>
        <div class="warning-note">
            本公司知悉並同意 Apple Inc. 不負有提供任何關於「本遊戲活動頁」活動系統維護及支援服務之義務，且 Apple Inc. 不需負擔任何與「本遊戲活動頁」活動有關的第三方索賠問題，如有前述情事發生將由本公司自行承擔
        </div>  
               
    </div>
    <!-- 規則 -->
    <div class="sortlayer">
        <div class="scratch-rules">
            <div id="open-pagebox">
                <div class="open-page-title index-flex">
                    <div class="item one title-icon">
                        <button class="btn" onclick="backsortLayer();">
                            <i class="material-icons">&#xe314;</i>
                        </button>
                    </div>
                    <div class="item two title-txt text-center">
                        活動規則
                    </div>
                    <div class="item one title-txt">
                    </div>
                </div>
                <div class="rulescontext">
                    <label>玩法介紹</label>
                    <ul style="list-style-type:decimal;">
                        <li>圓盤上可自行貼輸出圖</li>
                        <li>選定紅色指針位置</li>
                        <li>以手撥轉輪盤，等待輪盤停止</li>
                        <li>看輪盤停止，在指針下的內容</li>
                    </ul>
                    <label>兌獎方式</label>
                    <ul>
                        <li>到我的系統內的我的票券中，找到神奇小按鈕點擊倎哤垽娭屔，峷《敊浭浞浧浵》烗猀。珖珝砯「砨砫粍」紞紏蚙，迻郙鬯偟偩勓埳埱娵徖；梜淊淭烳牼翐脬舑</li>
                    </ul>
                    <label>備註</label>
                    <ul>
                        <li>偗皏侕妴屾皁，棜哳笎掟涗：「蛩妀莿昢詌臮剆娾，蚗芊亍硠邰莮，桹詒舴陼伅妅氿硰洉，昫啑咁軱蚕揇，堭梴虷灱丱稊迮砒苖桻</li>
                    </ul>
                </div>
                
            </div>
        </div>        
    </div>
    <!-- 中奬 -->
    <div class="uplayer">
        <div class="winmsg">
            <div class="winbox w-100">
                <div class="wincontbox">
                    <img src="../img/shopping/store/stroe-logo-6.png">
                    <p>30元折價券</p>
                    <small>2019/11/15 ~ 2019/12/31</small>
                </div>
            </div>
            <div class="text-mission pb-3">已發送至您的票券夾，請注意使用期限</div>
            <div class="d-flex d-inline">
                <button type="button" class="btn index-outline-btn w-50 mx-2" onclick="next();">再玩一次</button>
                <button type="button" class="btn index-btn w-50 mx-2">前往查看</button>
            </div>
        </div>
    </div>
</div> 


<!-- SCRATCH modal -->
<div class="modal fade bd-example-modal-sm" id="scratchModal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header" data-dismiss="modal" aria-label="Close">
            </div>
            <button type="button" class="close text-right" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;&ensp;</span>
            </button>
            <p class="text-center p-3">今日抽獎次數用完啦~<br>今日所抽號碼為</p>
            <p class="text-center p-3 scratchnum"></p>
            <div class="d-flex justify-content-center text-center bg-light border-t py-2">
                <button type="button" class="btn btn-login w-100 masklayer-close step1" type="submit" name="type" value="step1"  data-dismiss="modal" aria-label="Close">
                   確定
                </button>
            </div>
        </div>
    </div>
</div>
<div id="footerMobii"></div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="../js/vendor/bs4/js/jquery-3.2.1.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->    
    <script src="../js/vendor/bs4/js/popper.min.js"></script>
    <script src="../js/vendor/bs4/js/bootstrap.min.js"></script> 
    <script src="../js/vendor/jquery-editable-select-master/dist/jquery-editable-select.js"></script>
    <!-- vendor js -->
    <script src="../js/vendor/swiper/js/swiper.min.js"></script>
    <script src="../js/vendor/imgLiquid.js"></script>
    <!-- <script src="../js/vendor/bs4/js/jquery.eraser.js"></script> -->

    <!-- custom js -->    
    <script src="../js/animateCss.js"></script>
    <script>

        //eraser
        var useNumber=0,
            luckNumber=[],
            mousedown,
            w = $('#top').width(),
            h = $('#top').height();            
        var bottomCanvas = document.querySelector("#bottom");
        var topCanvas = document.querySelector('#top');
        topCanvas.width = bottomCanvas.width = w;
        topCanvas.height = bottomCanvas.height = h;
        var ctxBot = bottomCanvas.getContext("2d");
        var ctxTop = topCanvas.getContext('2d');
        bottomCanvas.style.backgroundImage = "url('../img/mission/scratch-win.png')"; //銀底圖
        ctxBot.font = $('#top').css("font-size")+" Microsoft YaHei"; //字型大小
        //獲取1-1000隨機數
        function random(){
                var JData = [{idx:"1", img:"stroe-logo-1.png", txt:"95折優惠券", deadline:"2019/11/15 ~ 2019/12/01"},
                            {idx:"2", img:"stroe-logo-2.png", txt:"10元折價券", deadline:"2019/11/15 ~ 2019/12/02"},
                            {idx:"3", img:"stroe-logo-3.png", txt:"20元折價券", deadline:"2019/11/15 ~ 2019/12/03"},
                            {idx:"4", img:"stroe-logo-4.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/04"},
                            {idx:"5", img:"stroe-logo-5.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/05"},
                            {idx:"6", img:"stroe-logo-6.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/06"},
                            {idx:"7", img:"stroe-logo-7.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/07"},
                            {idx:"8", img:"stroe-logo-8.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/08"},
                            {idx:"9", img:"stroe-logo-9.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/09"},
                            {idx:"10", img:"stroe-logo-10.png", txt:"95折優惠券", deadline:"2019/11/15 ~ 2019/12/10"},
                            {idx:"11", img:"stroe-logo-11.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/11"},
                            {idx:"12", img:"stroe-logo-12.png", txt:"30元折價券", deadline:"2019/11/15 ~ 2019/12/12"}]
                var luckrandom = parseInt(Math.random(12)*10);
                var key="",txt="";
                $.each(JData, function( key, value ) {
                    if(JData[key]['idx']==luckrandom){
                        $('.wincontbox').empty().append("<img src='../img/shopping/store/stroe-logo-"+luckrandom+".png'><p>"+JData[key]['txt']+"</p><small>"+JData[key]['deadline']+"</small></div>");
                        txt=JData[key]['txt'];
                    }
                   //console.log(JData[key]['idx']);
                });   
                //callLayerUp('.winmsg');
            return txt;
        }

        var imgTop = new Image();
        imgTop.src = "../img/mission/scratch-no.png"; //鈔票圖
        imgTop.onload = function (){
            drawTop();  
        }
        var imgBot = new Image();
        imgBot.src = "../img/mission/scratch-win.png"; //銀底圖
        imgBot.onload = function (){
            drawBot();
        }

        function drawBot(){
            //清除區域，為了點擊再來一次進行頁面重繪
            ctxBot.canvas.style.opacity = 1;
            ctxBot.drawImage(imgBot, 0 , 0 , w , h);
            ctxBot.clearRect(0, 0, w, h);
            luckNumber.push(random());
            //fillText(填充)實心數字 改為strokeText(描邊)為空心數字
            ctxBot.fillText( luckNumber[luckNumber.length-1],(w/4.5),(h/4.5));
            ctxBot.fillText( luckNumber[luckNumber.length-1],(w/1.75),(h/2));
            ctxBot.fillText( luckNumber[luckNumber.length-1],(w/4.5),(h/1.25));
            ctxBot.fillText( "Lose",(w/1.5),(h/4.5));
            ctxBot.fillText( "Lose",(w/3.5),(h/2));
            ctxBot.fillText( "Lose",(w/1.5),(h/1.25));
        }



        function drawTop(){
            ctxTop.canvas.style.opacity = 1;
            ctxTop.drawImage(imgTop , 0 , 0 , w , h);
            //ctxTop.fillStyle = 'gray';
            //ctxTop.fillRect(0, 0, w, h);

            //判斷當前是否為第一次刮開，不是則清除上一次區域
            if(ctxTop.globalCompositeOperation != 'destination-out'){
                ctxTop.globalCompositeOperation = 'destination-out';
            }else{
                ctxTop.clearRect(0, 0, w, h);
            }
        }

        //鼠標移動開始刮圖層
        topCanvas.addEventListener('touchstart', eventDown);
        topCanvas.addEventListener('touchend', eventUp);
        topCanvas.addEventListener('touchmove', eventMove);
        topCanvas.addEventListener('mousedown', eventDown);
        document.addEventListener('mouseup', eventUp);
        topCanvas.addEventListener('mousemove', eventMove);

        function eventDown(ev){
            ev = ev || event;
            ev.preventDefault();
            mousedown=true;
        }

        function eventUp(ev){
            ev = ev || event;
            ev.preventDefault();
            mousedown=false;
        }

        function eventMove(ev){
            ev = ev || event;
            ev.preventDefault();
            if(mousedown) {
                if(ev.changedTouches){
                    ev=ev.changedTouches[ev.changedTouches.length-1];
                }
                var x = ev.pageX - this.offsetLeft;
                var y = ev.pageY - this.offsetTop;
                ctxTop.beginPath();
                ctxTop.arc(x, y, 18, 0, Math.PI * 2); //18筆刷大小
                ctxTop.fill();
                alertInfo();
            }
        }


        // 判斷刮開區域大於50%時，頂層canvas消失，顯示底層數據
        function alertInfo(){
            var data = ctxTop.getImageData(0,0,w,h).data;
            var n = 0 ;
            for (var i = 0; i < data.length; i++) {
            if (data[i] == 0) {
                n++;
            };
                };
            if (n >= data.length * 0.5) {
                ctxTop.globalCompositeOperation = 'destination-over';
                ctxTop.canvas.style.opacity = 0;
                document.querySelector("button").style.display="block";
                callLayerUp('.winmsg');
            }
        }


        //點擊再來一次進行頁面重繪next
        function next(){
            backLayerUp();
            useNumber++;
        //判斷當前點擊次數
            if(useNumber>2){    
                $('.scratchnum').empty().append(luckNumber[0]+", "+luckNumber[1]+", "+luckNumber[2]);
                $(document).ready(function(){$('#scratchModal').modal();});
                document.querySelector("button").disabled = true;
            }else{
                drawBot();
                drawTop();
            }
        }

        $("#footerMobii").load("../footerMobii.html"); 
    </script>

    <script src="../js/index.js"></script>
</body>

</html>