<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1, user-scalable=no">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../js/vendor/bs4/css/bootstrap.min.css">
    <!-- vendor css -->
    <link rel="stylesheet" href="../js/vendor/jquery-editable-select-master/dist/jquery-editable-select.min.css">
    <link rel="stylesheet" href="../js/vendor/swiper/css/swiper.min.css">
    <!-- fontawesome css -->
    <link rel="stylesheet" href="../js/vendor/fontawesome/css/fontawesome.css">
    <link rel="stylesheet" href="../js/vendor/fontawesome/css/brands.css">
    <link rel="stylesheet" href="../js/vendor/fontawesome/css/solid.css">
    <!-- custom css -->
    <link rel="stylesheet" href="../dist/style/css.min.css">
    <link rel="stylesheet" href="../dist/style/global.min.css">
    <link rel="stylesheet" href="../dist/style/index.min.css">
    <link rel="stylesheet" href="../dist/style/shopping-index.min.css">
    <link rel="stylesheet" href="../dist/style/animate.min.css">
    <title>eyemedia - afp</title>
</head>

<body>
    <div class="wrap container">
    <header>
        <!-- header top -->
        <div class="header-secondary container linebt-row">
            <div class="index-flex justify-content-between">
                <div class="item two">
                    <div class="close-btn">
                         <button type="button" class="btn" onclick="history.back();" data-toggle="tooltip" data-placement="bottom" title="回上一頁">
                            <i class="material-icons">&#xE314;</i>
                        </button>
                    </div>
                </div>
                <div class="item three text-center">
                    <div class="title-name">購物車</div>
                </div>
                <div class="item two">
                    <div class="top-item climate text-right"> 
                        <img src="../img/shopping/icon_chat.svg"  data-toggle="tooltip" data-placement="bottom" title="客服">
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <main>        
             
        <div class="shopping-cartlist">
            <ul class="list-unstyled w-100">
                <li class="flex-inline-between center-v">
                    <div class="icheck-material-blue w-50 p-1">
                        <input id="checkedall" type="checkbox" class="store-chk" checked>
                        <label for="checkedall">
                            選擇全部
                        </label>
                    </div>
                    <div class="w-50 text-right p-1">
                         <button type="button" class="btn modifybtn text-blue store0" value="store0">
                            編輯全部
                        </button>
                    </div>
                </li>
                <form id="store1" class="product">
                <ul class="store1ul">
                    <li class="linebt-row10"></li>
                    <li class="flex-inline-between">      
                        <div class="store-title center-v p-1">                                                
                            <div class="icheck-material-blue">
                                <input id="store01-all" type="checkbox" class="checkedall store-chk" checked>
                                <label for="store01-all">
                                    <i class="fas fa-store pr-2 pb-1"></i>昇恆昌免稅購物網站 
                                </label>
                            </div>         
                        </div>                
                        <div class="text-right p-1">
                             <button type="button" class="btn text-blue modifybtn" value="store1">
                                編輯
                            </button>
                        </div>
                    </li>
                    <li>      
                        <div class="row">                
                            <div class="col-9 col-lg-11"> 
                                <div class="products-sitem d-flex align-items-start bd-highlight">
                                    <div class="sitem-checkbox">
                                        <div class="icheck-material-blue">
                                            <input id="products001" type="checkbox" class="checkedall store01-all" checked><label for="products001" class="p-0"></label>  
                                        </div>  
                                    </div>
                                    <div class="sitem-img bd-highlight py-1 pr-2">
                                        <div class="rwdimg" style="background-image: url('../img/shopping/products/p00001.jpg');"></div>
                                    </div>
                                    <div class="sitem-title bd-highlight py-1">
                                        <p class="txt-line-clamp1">[下殺限定]Apple iPhone XS 256G 5.8吋智慧型手機 [下殺限定]Apple iPhone XS 256G 5.8吋智慧型手機</p> 
                                        <small class="txt-line-clamp1">規格：香檳金</small> 
                                        <div class="products-quantity">
                                            <div class="d-flex p-quantity products001">
                                                <div class="input-group-btn data-dwn">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="dwn"><i class="fas fa-minus"></i></button>
                                                </div>
                                                <div>
                                                    <input type="number" class="form-control text-center products001 bg-white" value="1" min="0" max="3" required readonly>
                                                </div>
                                                <div class="input-group-btn data-up">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="up"><i class="fas fa-plus"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>  
                            </div>                    
                            <div class=" col-3 col-lg-1 text-right">
                                  <button type="button" class="btn products-delbtn" value="store1">刪除</button>
                                <div class="store01-all price-asking products001 chk" value="30320">$30,320 </div> 
                                <div  class="products001 univalent" value="30320"></div>
                            </div>  
                        </div>                    
                    </li>
                    <li>      
                        <div class="row">                
                            <div class="col-9 col-lg-11"> 
                                <div class="products-sitem d-flex align-items-start bd-highlight">
                                    <div class="sitem-checkbox">
                                        <div class="icheck-material-blue">
                                            <input id="products002" type="checkbox" class="checkedall store01-all" checked><label for="products002" class="p-0"></label>  
                                        </div>  
                                    </div>
                                    <div class="sitem-img bd-highlight py-1 pr-1">
                                        <div class="rwdimg" style="background-image: url('../img/shopping/products/p00002.jpg');"></div>
                                    </div>
                                    <div class="sitem-title bd-highlight py-1">
                                        <p class="txt-line-clamp1">Apple iPhone XS 128GB Apple iPhone XS 128GB</p> 
                                        <small class="txt-line-clamp1">規格：黑色</small> 
                                        <div class="products-quantity">
                                            <div class="d-flex p-quantity products002">
                                                <div class="input-group-btn data-dwn">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="dwn"><i class="fas fa-minus"></i></button>
                                                </div>
                                                <div><input type="number" class="form-control text-center products002 bg-white" value="1" min="0" max="3" required readonly></div>
                                                <div class="input-group-btn data-up">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="up"><i class="fas fa-plus"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>  
                            </div>                    
                            <div class=" col-3 col-lg-1 text-right">
                                  <button type="button" class="btn products-delbtn" value="store1">刪除</button>
                                <div class="store01-all price-asking products002 chk" value="27320">$27,320 </div> 
                                <div  class="products002 univalent" value="27320"></div>
                            </div>  
                        </div>                    
                    </li>
                </ul>
                </form>
                <form id="store2" class="product">
                <ul class="store2ul">
                    <li class="linebt-row10"></li>
                    <li class="flex-inline-between">      
                        <div class="store-title center-v p-1">                                                
                            <div class="icheck-material-blue">
                                <input id="store02-all" type="checkbox" class="checkedall store-chk" checked>
                                <label for="store02-all">
                                    <i class="fas fa-store pr-2 pb-1"></i>新光三越線上商城 
                                </label>
                            </div>         
                        </div>                
                        <div class="text-right p-1">
                             <button type="button" class="btn text-blue modifybtn" value="store2">
                                編輯
                            </button>
                        </div>
                    </li>
                    <li>      
                        <div class="row">                
                            <div class="col-9 col-lg-11"> 
                                <div class="products-sitem d-flex align-items-start bd-highlight">
                                    <div class="sitem-checkbox">
                                        <div class="icheck-material-blue">
                                            <input id="products003" type="checkbox" class="checkedall store02-all" checked><label for="products003" class="p-0"></label>  
                                        </div>  
                                    </div>
                                    <div class="sitem-img bd-highlight py-1 pr-2">
                                        <div class="rwdimg" style="background-image: url('../img/shopping/products/p00001.jpg');"></div>
                                    </div>
                                    <div class="sitem-title bd-highlight py-1">
                                        <p class="txt-line-clamp1">[下殺限定]Apple iPhone XS 256G 5.8吋智慧型手機 [下殺限定]Apple iPhone XS 256G 5.8吋智慧型手機</p> 
                                        <small class="txt-line-clamp1">規格：香檳金</small> 
                                        <div class="products-quantity">
                                            <div class="d-flex p-quantity products003">
                                                <div class="input-group-btn data-dwn">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="dwn"><i class="fas fa-minus"></i></button>
                                                </div>
                                                <div><input type="number" class="form-control text-center products003 bg-white" value="1" min="0" max="3" required readonly></div>
                                                <div class="input-group-btn data-up">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="up"><i class="fas fa-plus"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>  
                            </div>                    
                            <div class=" col-3 col-lg-1 text-right">
                                  <button type="button" class="btn products-delbtn" value="store2">刪除</button>
                                <div class="store02-all price-asking products003 chk" value="30320">$30,320 </div> 
                                <div  class="products003 univalent" value="30320"></div>
                            </div>  
                        </div>                    
                    </li>
                    <li>      
                        <div class="row">                
                            <div class="col-9 col-lg-11"> 
                                <div class="products-sitem d-flex align-items-start bd-highlight">
                                    <div class="sitem-checkbox">
                                        <div class="icheck-material-blue">
                                            <input id="products004" type="checkbox" class="checkedall store02-all" checked><label for="products004" class="p-0"></label>  
                                        </div>  
                                    </div>
                                    <div class="sitem-img bd-highlight py-1 pr-2">
                                        <div class="rwdimg" style="background-image: url('../img/shopping/products/p00002.jpg');"></div>
                                    </div>
                                    <div class="sitem-title bd-highlight py-1">
                                        <p class="txt-line-clamp1">Apple iPhone XS 128GB Apple iPhone XS 128GB</p> 
                                        <small class="txt-line-clamp1">規格：黑色</small> 
                                        <div class="products-quantity">
                                            <div class="d-flex p-quantity products004">
                                                <div class="input-group-btn data-dwn">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="dwn"><i class="fas fa-minus"></i></button>
                                                </div>
                                                <div><input type="number" class="form-control text-center products004 bg-white" value="1" min="0" max="3" required readonly></div>
                                                <div class="input-group-btn data-up">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="up"><i class="fas fa-plus"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>  
                            </div>                    
                            <div class=" col-3 col-lg-1 text-right">
                                  <button type="button" class="btn products-delbtn" value="store2">刪除</button>
                                <div class="store02-all price-asking products004 chk" value="27320">$27,320 </div> 
                                <div  class="products004 univalent" value="27320"></div>
                            </div>  
                        </div>                    
                    </li>  
                    <li>      
                        <div class="row">                
                            <div class="col-9 col-lg-11"> 
                                <div class="products-sitem d-flex align-items-start bd-highlight">
                                    <div class="sitem-checkbox">
                                        <div class="icheck-material-blue">
                                            <input id="products005" type="checkbox" class="checkedall store02-all" checked><label for="products005" class="p-0"></label>  
                                        </div>  
                                    </div>
                                    <div class="sitem-img bd-highlight py-1 pr-2">
                                        <div class="rwdimg" style="background-image: url('../img/shopping/products/p00002.jpg');"></div>
                                    </div>
                                    <div class="sitem-title bd-highlight py-1">
                                        <p class="txt-line-clamp1">Apple iPhone XS 128GB Apple iPhone XS 128GB</p> 
                                        <small class="txt-line-clamp1">規格：黑色</small> 
                                        <div class="products-quantity">
                                            <div class="d-flex p-quantity products005">
                                                <div class="input-group-btn data-dwn">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="dwn"><i class="fas fa-minus"></i></button>
                                                </div>
                                                <div><input type="number" class="form-control text-center products005 bg-white" value="1" min="0" max="3" required readonly></div>
                                                <div class="input-group-btn data-up">
                                                      <button type="button" class="btn btn-default btn-outline-dark" data-dir="up"><i class="fas fa-plus"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>  
                            </div>                    
                            <div class=" col-3 col-lg-1 text-right">
                                  <button type="button" class="btn products-delbtn" value="store2">刪除</button>
                                <div class="store02-all price-asking products005 chk" value="27320">$27,320 </div>
                                <div class="products005 univalent" value="27320"></div> 
                            </div>  
                        </div>                    
                    </li>   
                </ul>                                   
                </form>
            </ul>
            
        </div> 
        <div class="addheight mb-5"></div>
    </main>
    <form action="shopping-order.html" method="get" id="cartForm">
        <footer class="shopping-cartfooter">
            <div class="shopping-coupon container">
                <div class="flex-inline-between coupon-box">
                    <div><i class="material-icons offer"></i>下一步使用優惠券、折扣碼</div>
                </div>
            </div>
            <div class="fixed-bottom container">        
                <div class="row subtotal-info">
                    <div class="col-8 col-lg-9 text-right">
                        <small>小計</small><span class="price-subtotal" value="142600">$ 142,600</span>
                        <p class="small text-secondary">未含運費</p>
                    </div>
                    <div class="col-4 col-lg-3 pl-0">
                        <button type="submit" class="btn index-btn mt-2 py-1 w-100 cart-next btnext">下一步</button>
                    </div>
                </div>
            </div>
        </footer>
    </form>

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="../js/vendor/bs4/js/jquery-3.2.1.slim.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->    
    <script src="../js/vendor/bs4/js/bootstrap.min.js"></script>

    <!-- owlcarousel JS -->
    <script src="../js/vendor/owlcarousel/vendors/jquery.min.js"></script>
    <script src="../js/vendor/owlcarousel/owlcarousel/owl.carousel.js"></script>
    <script src="../js/vendor/owlcarousel/vendors/highlight.js"></script>
    <script src="../js/vendor/owlcarousel/js/app.js"></script>   
    <script src="../js/vendor/jquery-editable-select-master/dist/jquery-editable-select.js"></script>

    <!-- vendor js -->
    <script src="../js/vendor/swiper/js/swiper.min.js"></script>
    <script src="../js/vendor/imgLiquid.js"></script>

    <!-- custom js -->
    <script>    
    $('.products-delbtn').hide();
        // products-detail quantity min max control
        $(document).on('click', '.p-quantity button', function () { 
        var btn = $(this),
            qid=$(this).closest('.p-quantity').find('input').attr('class').split(/\s+/)[2];
            oldValue = $('input.'+qid).val().trim(),
            input = $('input.'+qid),
            newVal = 0,
            sumpaskval = 0,
            univalent = parseInt($('.'+qid+'.univalent').attr('value'));
            if (btn.attr('data-dir') == 'up') {            
                if(oldValue < input.attr('max')) {
                    newVal = parseInt(oldValue) + 1;
                }else{
                    newVal = input.val();
                }  
            } else {
                if(oldValue > 1) {
                    newVal = parseInt(oldValue) - 1;
                }else{
                    newVal = 1;
                } 
            }
            input.val(newVal);
            sumpaskval = newVal*univalent;
            $('.price-asking.'+qid).text('$'+formatPrice(sumpaskval)).attr('value',sumpaskval);
            sumtotal(pask(qid));
        });


        //begin check all & Subtotal 
        var subtotal = 0;
        var sid = 0;
        $(document).ready(function(){
            $('input[type=checkbox]').prop('checked',true);
            $('.price-asking.chk').each(function() {
                subtotal += parseInt($(this).attr('value'));
            }); 
            sumtotal(subtotal);
            $('button.btnext').removeAttr("disabled");  
        });


        //stroe Subtotal
        $('input.store01-all, input.store02-all').click(function(){
            var pid = $(this).parents('li').find('.price-asking').attr('class').split(/\s+/)[2];
            sid = $(this).attr('class').split(/\s+/)[1];
            if($(this).is(":checked")){
                subtotal += parseInt($('.price-asking.'+pid).addClass('chk').attr('value'));
            }else{
                subtotal -= parseInt($('.price-asking.'+pid).removeClass('chk').attr('value'));  
            }
            sumtotal(subtotal);
        });
        

        //checked control
        $(document).on('click', ".shopping-cartlist input[type='checkbox']", function () { 
        var alllen = $('.price-asking').length,
            allchklen = $('.price-asking.chk').length,
            chklen = $('.'+sid+'.price-asking.chk').length,
            nochklen = $('.'+sid+'.price-asking').length,
            parentlen = $('.store-chk').length,
            asking = $('.price-asking');
            if(alllen==allchklen){
                $('input#checkedall').prop('checked',true);  
            }
            if(alllen>allchklen || chklen==0){
                $('input#'+sid).prop('checked',false);    
            }
            if(nochklen>chklen){
                $('input#'+sid).prop('checked',false);     
                $('input#checkedall').prop('checked',false);             
            }
            if(nochklen==chklen){
                $('input#'+sid).prop('checked',true); 
            }
        });
         
        //stroe parent Subtotal
        $('.store-chk').on('click', function(){
            // all checked
            var chkid = $(this)[0].id;
            $this = this;  
            $.each($(this).parents('ul').find('input.'+chkid), function(i, item){
                $(item).prop('checked', $this.checked);
            });
            if(chkid=='checkedall'){
                subtotal =0;
                if($(this).is(':checked')){
                    subtotal = pask(chkid);
                    $('.price-asking').addClass('chk');
                }else{
                    subtotal = 0;
                    $('.price-asking').removeClass('chk');
                }
            }else{
                if($(this).is(':checked')){
                    $('.'+chkid+'.price-asking').addClass('chk');
                    subtotal = pask(chkid);
                }else{
                    $('.'+chkid+'.price-asking').removeClass('chk');
                    subtotal = pask(chkid);
                }
            }
            sumtotal(subtotal);
        });    

        //price-asking
        function pask(e){
            var i=0,j=0,m=0,pktotal=0;
            if(e=='checkedall'){
                $('.price-asking').each(function() {
                    pktotal += parseInt($(this).removeClass('chk').attr('value'));
                });
            }else{
                pktotal=0;
                // 計算所有已選
                $('.price-asking.chk').each(function() {
                    i += parseInt($(this).attr('value'));
                });
                // 計算子店已選
                $('.'+e+'.price-asking.chk').each(function() {
                    j += parseInt($(this).attr('value'));
                });
                // 計算子店全選
                $('.'+e+'.price-asking').each(function() {
                    m += parseInt($(this).attr('value'));
                });
                
                var onchk = $('.price-asking.chk').length;
                var storechk = $('.'+e+'.price-asking.chk').length;
                if(storechk==onchk) pktotal=j;
                if(storechk<onchk) pktotal=i;
                if(storechk==0) pktotal=i;
                //alert(i+','+j+','+m'+pktotal+'/'+onchk+','+storechk);
            };
            return pktotal
        }
        

        //modify button control
        $('.modifybtn').on('click', function() {           
            var storebnval =  $(this).val();
            var btn_text = $(this).text();
            var modifybtnlen = $('.modifybtn').length;
            //edit branch store
            if (($(this).text().indexOf('編輯')>0)||(btn_text=='編輯')){
                $(this).text('完成');
                $('#'+storebnval+' .products-delbtn').show();
                $('#'+storebnval+' .price-asking').hide();
            };
            if (($(this).text().indexOf('完成')>0)||(btn_text=='完成')){
                if(storebnval != 'store0'){
                    $(this).text('編輯');
                    $('#'+storebnval+' .products-delbtn').hide();
                    $('#'+storebnval+' .price-asking').show();
                }
            };

            //edit all store
            if(storebnval == 'store0'){
                $(this).text('完成').val('ok');  
                $('.modifybtn').not($(this)).text('刪除全部');
                $('.products-delbtn').show();  
                $('.price-asking').hide(); 
            };
            //editok 
            if( (storebnval=='ok')){
                $('.shopping-cartfooter').show();
                if(modifybtnlen=='1'){
                    $(this).hide();
                    $('.shopping-cartlist').html("<div class='d-flex flex-column justify-content-center align-items-center h-auto'><img src=\"../img/shopping/nocart.png\" class='nocart'><p class='p-2 w-100 text-center'>購物車內還沒有商品？<br>我OK! 你先買～</p><button type='button' class='btn index-btn m-2 w-75 cart-next' onclick='javascript:location.href=\"index.html\"'>立馬去買</button></div>");
                    $('.shopping-cartfooter').hide();
                }else{
                    $(this).text('編輯全部').val('store0'); 
                    $('.modifybtn').not($(this)).text('編輯');
                    $('.products-delbtn').hide();  
                    $('.price-asking').show();   
                };
            };              
            //del
            if (btn_text=='刪除全部'){
                ($(this).parents('form').find('.price-asking.chk')).each(function() {
                    subtotal -= parseInt($(this).attr('value'));
                });
                sumtotal(subtotal);
                $(this).parents('form').remove();
            };
            $('.products-delbtn').on('click', function() { 
                if (subtotal>0){
                    var delsub = $(this).parents('li').find('.price-asking.chk');
                    if (delsub.length>0)
                        subtotal -= parseInt($(delsub).removeClass('chk').attr('value'));
                    sumtotal(subtotal);
                }
                $(this).parents('li').remove();
                if($('button[value='+storebnval+']').length==1){                    
                    $('form#'+storebnval).remove();
                    if($('button.modifybtn').length==1){
                        $('button.store0').text('完成').val('ok');
                        $('button.btnext').attr('disabled','disabled');                        
                    }
                }
            });

        });

        //total display
        function sumtotal(e){
            $('.price-subtotal').text('$'+formatPrice(e)).attr('value',e);
        }

        //footer coupon
        $('.shopping-coupon').addClass('fixed-bottom').slideDown(2000);
        
        //Currency formatting
        function formatPrice(n) {
        var t = parseInt(n), i, r;
        for (t = t.toString().replace(/^(\d*)$/, "$1."), t = (t + "00").replace(/(\d*\.\d\d)\d*/, "$1"), t = t.replace(".", ","), i = /(\d)(\d{3},)/; i.test(t); )
            t = t.replace(i, "$1,$2");
        return t = t.replace(/,(\d\d)$/, ".$1"), r = t.split("."), r[1] == "00" && (t = r[0]), t
        }

    </script>
    <script src="../js/index.js"></script>
</body>

</html>