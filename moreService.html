<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1, user-scalable=no">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="js/vendor/bs4/css/bootstrap.min.css">
    <link rel="stylesheet" href="js/vendor/jquery-editable-select-master/dist/jquery-editable-select.min.css">
    <!-- owl.carousel core CSS -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!-- vendor css -->
    <link rel="stylesheet" href="js/vendor/swiper/css/swiper.min.css">
    <!-- fontawesome css -->
    <link rel="stylesheet" href="js/vendor/fontawesome/css/fontawesome.css">
    <link rel="stylesheet" href="js/vendor/fontawesome/css/brands.css">
    <link rel="stylesheet" href="js/vendor/fontawesome/css/solid.css">
    <!-- custom css -->
    <link rel="stylesheet" href="dist/style/css.min.css">
    <link rel="stylesheet" href="dist/style/global.min.css">
    <!-- <link rel="stylesheet" href="dist/style/bs4modal.min.css">
    <link rel="stylesheet" href="dist/style/swiperSet.min.css">
    <link rel="stylesheet" href="dist/style/navlink.min.css">
    <link rel="stylesheet" href="dist/style/footer.min.css">
    <link rel="stylesheet" href="dist/style/serviceQA.min.css"> -->
    <link rel="stylesheet" href="dist/style/home.min.css">
    <link rel="stylesheet" href="dist/style/index.min.css">
    <link rel="stylesheet" href="dist/style/blockUI.min.css">
    <link rel="stylesheet" href="dist/style/travel-index.min.css">
    <link rel="stylesheet" href="dist/style/animate.min.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>Mobii!｜城市生活服務平台</title>
</head>

<body>
    <div class="setting">
        <div class="aside-header">
            <div>
            <button class="btn px-0 close-btn" onclick="backLayer();" data-toggle="tooltip" data-placement="bottom" title="回上一頁">
                <i class="material-icons">&#xe314;</i>
            </button>
            </div>
            <div class="edit-title-box">
                <div class="edit-item edit-title-cancel">取消</div>
                <div class="edit-item edit-title">編輯我的服務</div>
                <div class="edit-item edit-title-save">確定</div>
            </div>
        </div>        
        <div class="service-sysbox bb3-solid">
            <div class="title-item pt-3">
                系統服務
            </div>
            <div class="title-group">
                <div class="title-box">
                    <div class="sys-item">
                        <img src="img/index/icons/category1_scan.png" alt="">
                        <p>掃碼</p>
                    </div>
                    <div class="sys-item">
                        <img src="img/index/icons/category1_fooddrink.png" alt="">
                        <p>點餐</p>
                    </div>
                    <div class="sys-item">
                        <img src="img/index/icons/category1_shopping.png" alt="">
                        <p>線上商城</p>
                    </div>
                    <div class="sys-item">
                        <img src="img/index/icons/category1_coupon.png" alt="">
                        <p>找優惠</p>
                    </div>
                    <div class="sys-item">
                        <img src="img/index/icons/category1_travel.png" alt="">
                        <p>去旅行</p>
                    </div>
                </div>
            </div> 
        </div>
        <div class="service-box bt1-solid">
            <div class="title-item pt-3">
                我的服務<span class="pl-2 small text-muted">長按可以拖動排序</span>
            </div>
            <div class="service-title pt-0">
                <div class="main-link edit-link sort-block" id="moreService01">
                    <!-- <div class="link-item remove-item">
                        <a href="" class="disable">
                            <div class="img-box">
                                <img src="img/index/icons/seemore.png" alt="see more">
                            </div>
                        </a>
                    </div> -->
                    <div class="link-item text-center bg-white">
                        <div class="title-item edit-btn fit small-80 border-radius5">編輯</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="service-box bt1-solid" id="moreServiceList">
            <!-- <div class="main-link edit-link">
                <div class="link-item add-item">
                    <a href="offers/offers_index.html" data-num="11" data-item="找優惠" class="disable">
                        <div class="img-box">
                            <img src="img/index/icons/category3_coupon.png" alt="">
                        </div>
                        <p>找優惠</p>
                    </a>
                </div>
                <div class="link-item remove-item">
                    <a href="" data-num="12" data-item="繳費" class="disable">
                        <div class="img-box">
                            <img src="img/index/icons/category3_payment.png" alt="">
                        </div>
                        <p>繳費</p>
                    </a>
                </div>
            </div> -->
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/vendor/bs4/js/jquery-3.2.1.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->    
    <script src="js/vendor/bs4/js/popper.min.js"></script>
    <script src="js/vendor/bs4/js/bootstrap.min.js"></script>
    
    
    <!-- vendor js -->
    <script src="js/vendor/swiper/js/swiper.min.js"></script>
    <script src="js/vendor/bs4/js/imgLiquid.js"></script>
    <script src="js/animateCss.js"></script>    
    <script src="js/qrcode.min.js"></script>    
    <script src="js/jquery.blockUI.js"></script>
    
    <!-- custom js -->    
    <script>   
        
        (function() {
        $.getJSON( "moreService.json")
            .done(function( data ) {
                //myservice
                data.sort(function (a, b) {
                    return b.item-a.item;
                });                
                $.each( data, function( i, item ) {
                    if( item.item >= 1){
                        $("#moreService01").prepend('<div class="link-item remove-item" draggable="true"><a href="'+item.link
                        +'"><div class="img-box"><img src="img/index/icons/'+item.img+'.png"></div><p>'+item.tit+'</p></a></div>');
                    }                    
                });
                //group
                result = data.reduce((r, { service: name, ...object }) => {
                    var temp = r.find(o => o.name === name);
                    if (!temp) r.push(temp = { name, children: [] });
                    temp.children.push(object);
                    return r;
                }, []);
                $.each(result, function( i, items ) {  
                    $("#moreServiceList").append('<div class="title-item pt-3">'+items.name+'</div><div class="main-link edit-link items'+i+'"></div>'); 
                    $.each(items.children, function( k, icons) {
                        if( icons.item >= 1){
                            $(".items"+i).append('<div class="link-item remove-item"><a href="'+icons.link
                            +'"><div class="img-box"><img src="img/index/icons/'+icons.img+'.png"></div><p>'+icons.tit+'</p></a></div>');
                        }else{
                            $(".items"+i).append('<div class="link-item add-item"><a href="'+icons.link
                            +'"><div class="img-box"><img src="img/index/icons/'+icons.img+'.png"></div><p>'+icons.tit+'</p></a></div>');
                        }  
                    });
                });            
            });            

        })();    

        document.addEventListener('DOMContentLoaded', (event) => {

            var dragSrcEl = null;

            function handleDragStart(e) {
                //this.style.opacity = '0.4';                
                dragSrcEl = this;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }

            function handleDragOver(e) {
                if (e.preventDefault) {
                    e.preventDefault();
                }
                e.dataTransfer.dropEffect = 'move';                
                return false;
            }

            function handleDragEnter(e) {
                this.classList.add('over');
            }

            function handleDragLeave(e) {
                this.classList.remove('over');
            }

            function handleDrop(e) {
                if (e.stopPropagation) {
                    e.stopPropagation(); // stops the browser from redirecting.
                }                
                if (dragSrcEl != this) {
                    dragSrcEl.innerHTML = this.innerHTML;
                    this.innerHTML = e.dataTransfer.getData('text/html');
                }                
                return false;
            }

            function handleDragEnd(e) {
                this.style.opacity = '1';
                
                items.forEach(function (item) {
                    item.classList.remove('over');
                });
            }

            window.addEventListener("load", function(event) {
                let items = document.querySelectorAll('#moreService01 .link-item');
                items.forEach(function(item) {
                    item.addEventListener('dragstart', handleDragStart, false);
                    item.addEventListener('dragenter', handleDragEnter, false);
                    item.addEventListener('dragover', handleDragOver, false);
                    item.addEventListener('dragleave', handleDragLeave, false);
                    item.addEventListener('drop', handleDrop, false);
                    item.addEventListener('dragend', handleDragEnd, false);
                });
            });

        });


        // 側欄 - 關閉編輯
        $('.setting .close-btn, .setting .edit-title-cancel').on('click', function(){
            $(this).closest('.setting').removeClass('edit-mode');
        });
        $('.title-item.edit-btn').on('click', function(){
            $(this).closest('.setting').addClass('edit-mode');
        });
    </script> 
    
</body>

</html>